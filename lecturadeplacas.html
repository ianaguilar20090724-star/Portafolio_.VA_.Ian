<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Control de Placas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .back-button {
            display: inline-block;
            background: white;
            color: #667eea;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .content-wrapper {
            background: #f5f5f5;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .tema-titulo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tema-titulo h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .tema-titulo p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .section h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .code-container {
            background: #2d3748;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
            margin-top: 15px;
        }

        .code-container pre {
            margin: 0;
            color: #e2e8f0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .glosario-item {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glosario-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .glosario-item h4 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 10px;
            font-family: 'Courier New', Courier, monospace;
        }

        .glosario-item p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .access-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .access-card {
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid;
            color: white;
            transition: transform 0.3s ease;
        }

        .access-card:hover {
            transform: scale(1.05);
        }

        .authorized {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #34d399;
        }

        .denied {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #f87171;
        }

        .access-card .icon {
            font-size: 5em;
            margin-bottom: 15px;
        }

        .access-card h4 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .access-card .plate {
            background: white;
            color: #1e293b;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            font-weight: bold;
            margin: 15px 0;
            border: 3px solid #1e293b;
        }

        .flow-diagram {
            background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .flow-step {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .flow-step .number {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .plates-list {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .plate-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .plate-item .icon {
            font-size: 1.5em;
        }

        .info-box {
            background: #e0e7ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #667eea;
        }

        .info-box strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        .warning-box {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #f59e0b;
        }

        .warning-box strong {
            color: #d97706;
            display: block;
            margin-bottom: 5px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-box {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            border: 2px solid #667eea;
        }

        .comparison-box h5 {
            color: #60a5fa;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }

        .comparison-box .example {
            background: #475569;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .tema-titulo h2 {
                font-size: 1.5em;
            }

            .section h3 {
                font-size: 1.5em;
            }

            .access-demo, .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">‚Üê Volver al Cat√°logo</a>
        
        <div class="header">
            <h1>Realizado por: Ian Martin Aguilar Alejo</h1>
            <p>Especialidad de IA del CBTIS 144</p>
        </div>

        <div class="content-wrapper">
            <div class="tema-titulo">
                <h2>üöó Sistema de Control de Acceso Vehicular</h2>
                <p>Reconocimiento autom√°tico de placas con OCR</p>
            </div>

            <div class="section">
                <h3>‚úÖ Estados de Acceso</h3>
                <div class="access-demo">
                    <div class="access-card authorized">
                        <div class="icon">‚úÖ</div>
                        <h4>ACCESO AUTORIZADO</h4>
                        <div class="plate">XYZ789</div>
                        <p>Placa registrada en la base de datos</p>
                        <p style="margin-top: 15px;">Bienvenido al estacionamiento</p>
                    </div>
                    <div class="access-card denied">
                        <div class="icon">üö´</div>
                        <h4>ACCESO DENEGADO</h4>
                        <div class="plate">ABC123</div>
                        <p>Placa NO registrada</p>
                        <p style="margin-top: 15px;">Su acceso ha sido denegado</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üìã Placas Autorizadas</h3>
                <div class="plates-list">
                    <div class="plate-item">
                        <span class="icon">üöô</span>
                        <span>XYZ789</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöó</span>
                        <span>HDUS-22</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöï</span>
                        <span>UISG-33</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöô</span>
                        <span>OSHO-D9</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöó</span>
                        <span>IU82-94</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöï</span>
                        <span>WHIW-34</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöô</span>
                        <span>AAA-OOO-A</span>
                    </div>
                    <div class="plate-item">
                        <span class="icon">üöó</span>
                        <span>ZAC-012-A</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üîÑ Proceso del Sistema</h3>
                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="number">1</div>
                        <div class="text"><strong>Captura:</strong> Cargar imagen de la placa vehicular</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">2</div>
                        <div class="text"><strong>Redimensionar:</strong> Ajustar tama√±o a 800√ó300 para procesamiento</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">3</div>
                        <div class="text"><strong>Escala de Grises:</strong> Convertir imagen a monocrom√°tico</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">4</div>
                        <div class="text"><strong>Binarizaci√≥n:</strong> Separar texto del fondo con threshold</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">5</div>
                        <div class="text"><strong>OCR:</strong> Extraer texto de la placa con Tesseract</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">6</div>
                        <div class="text"><strong>Limpieza:</strong> Eliminar espacios y caracteres innecesarios</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">7</div>
                        <div class="text"><strong>Validaci√≥n:</strong> Comparar con base de datos autorizada</div>
                    </div>
                    <div class="flow-step">
                        <div class="number">8</div>
                        <div class="text"><strong>Respuesta:</strong> Permitir o denegar acceso</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üìù C√≥digo del Ejemplo</h3>
                <div class="code-container">
                    <pre>
import cv2
import pytesseract

# Configurar ruta de Tesseract
pytesseract.pytesseract.tesseract_cmd = r"C:\Program Files\Tesseract-OCR\tesseract.exe"

# Lista de placas autorizadas para el estacionamiento
PA = [
    "XYZ789", "HDUS-22", "UISG-33", "OSHO-D9", 
    "IU82-94", "WHIW-34", "AAA-OOO-A", "ZAC-012-A"
]

# Cargar imagen de la placa
P = cv2.imread('Kat.jpg')

# Redimensionar para procesamiento uniforme
PN = cv2.resize(P, (800, 300))

# Convertir a escala de grises
PG = cv2.cvtColor(PN, cv2.COLOR_BGR2GRAY)

# Aplicar binarizaci√≥n para mejorar OCR
PRES = cv2.threshold(PG, 120, 255, cv2.THRESH_BINARY)[1]

# Configurar OCR y extraer texto
texto = pytesseract.image_to_string(PRES, lang="spa")

# Limpiar texto (eliminar espacios y saltos de l√≠nea)
TL = texto.strip().replace(' ', '')

# Buscar placa en la lista autorizada
if TL in PA:
    print("="*50)
    print("‚úÖ ACCESO AUTORIZADO")
    print("="*50)
    print(f"La placa: {TL} est√° autorizada")
    print("Bienvenido al estacionamiento")
else:
    print("="*50)
    print("üö´ ACCESO DENEGADO")
    print("="*50)
    print(f"La placa: {TL} NO est√° autorizada")
    print("Su acceso ha sido denegado")

# Mostrar informaci√≥n de depuraci√≥n
print("\n" + "-"*50)
print("Texto extra√≠do (sin procesar):")
print(texto)
print("-"*50)

# Mostrar imagen procesada
cv2.imshow("Placa Detectada", PN)
cv2.waitKey(0)
cv2.destroyAllWindows()
                    </pre>
                </div>
            </div>

            <div class="section">
                <h3>üìö Funciones Clave</h3>

                <div class="glosario-item">
                    <h4>str.strip()</h4>
                    <p>Elimina espacios en blanco, saltos de l√≠nea y tabulaciones al inicio y final del string. Esencial para limpiar el texto extra√≠do por OCR.</p>
                    <div class="code-container" style="margin-top: 10px;">
                        <pre>
texto = "  XYZ789  \n"
limpio = texto.strip()
print(f"'{limpio}'")  # 'XYZ789'

# OCR puede retornar:
texto_ocr = "\n  ABC-123  \n\n"
print(f"'{texto_ocr.strip()}'")  # 'ABC-123'
                        </pre>
                    </div>
                </div>

                <div class="glosario-item">
                    <h4>str.replace(viejo, nuevo)</h4>
                    <p>Reemplaza todas las ocurrencias de un substring por otro. Se usa para eliminar espacios que OCR puede insertar entre caracteres.</p>
                    <div class="comparison-grid">
                        <div class="comparison-box">
                            <h5>Con Espacios (OCR crudo)</h5>
                            <div class="example">
                                "XYZ 789"<br>
                                "HD US-22"<br>
                                "AAA - OOO - A"
                            </div>
                        </div>
                        <div class="comparison-box">
                            <h5>Sin Espacios (Limpio)</h5>
                            <div class="example">
                                "XYZ789"<br>
                                "HDUS-22"<br>
                                "AAA-OOO-A"
                            </div>
                        </div>
                    </div>
                    <div class="code-container" style="margin-top: 10px;">
                        <pre>
placa_ocr = "XYZ 789"
placa_limpia = placa_ocr.replace(' ', '')
print(placa_limpia)  # "XYZ789"

# Encadenar m√∫ltiples replace
texto = "A B C - 1 2 3"
limpio = texto.replace(' ', '').replace('-', '')
print(limpio)  # "ABC123"
                        </pre>
                    </div>
                </div>

                <div class="glosario-item">
                    <h4>Operador "in" para Listas</h4>
                    <p>Verifica si un elemento existe en una lista. Retorna True si la placa est√° en la lista de autorizadas.</p>
                    <div class="info-box">
                        <strong>Complejidad:</strong><br>
                        La b√∫squeda en listas es O(n), para miles de placas considera usar un set: <code>PA = set([...])</code> con complejidad O(1).
                    </div>
                    <div class="code-container" style="margin-top: 10px;">
                        <pre>
placas_autorizadas = ["XYZ789", "ABC123", "DEF456"]

# Verificaci√≥n simple
if "XYZ789" in placas_autorizadas:
    print("Autorizada")  # Se ejecuta

# Con set (m√°s r√°pido para muchos elementos)
placas_set = set(placas_autorizadas)
if "XYZ789" in placas_set:
    print("Autorizada")  # M√°s eficiente
                        </pre>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üîß Mejoras de Preprocesamiento</h3>

                <div class="glosario-item">
                    <h4>T√©cnicas Avanzadas para Mejor Reconocimiento</h4>
                    <div class="code-container">
                        <pre>
import cv2
import pytesseract
import numpy as np

def procesar_placa_avanzado(imagen_path):
    """Procesamiento avanzado de placa vehicular"""
    
    # Cargar imagen
    img = cv2.imread(imagen_path)
    
    # Redimensionar
    img = cv2.resize(img, (800, 300))
    
    # Escala de grises
    gris = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    
    # MEJORA 1: Reducir ruido con filtro bilateral
    sin_ruido = cv2.bilateralFilter(gris, 11, 17, 17)
    
    # MEJORA 2: Ecualizaci√≥n de histograma (mejor contraste)
    equalizado = cv2.equalizeHist(sin_ruido)
    
    # MEJORA 3: Binarizaci√≥n adaptativa (mejor que umbral fijo)
    binario = cv2.adaptiveThreshold(equalizado, 255,
                                     cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
                                     cv2.THRESH_BINARY, 11, 2)
    
    # MEJORA 4: Operaciones morfol√≥gicas (limpiar)
    kernel = np.ones((3,3), np.uint8)
    procesada = cv2.morphologyEx(binario, cv2.MORPH_CLOSE, kernel)
    
    # OCR con configuraci√≥n espec√≠fica para placas
    config = '--psm 7 -c tessedit_char_whitelist=ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-'
    texto = pytesseract.image_to_string(procesada, config=config)
    
    return texto.strip().replace(' ', '').upper()

# Usar la funci√≥n
placa_detectada = procesar_placa_avanzado('placa.jpg')
print(f"Placa detectada: {placa_detectada}")
                        </pre>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üí° Sistema Completo con Registro</h3>

                <div class="glosario-item">
                    <h4>Versi√≥n Profesional con Base de Datos</h4>
                    <div class="code-container">
                        <pre>
import cv2
import pytesseract
from datetime import datetime
import json

class SistemaEstacionamiento:
    def __init__(self, archivo_placas="placas_autorizadas.json"):
        self.archivo_placas = archivo_placas
        self.placas_autorizadas = self.cargar_placas()
        self.registro_accesos = []
        
        # Configurar Tesseract
        pytesseract.pytesseract.tesseract_cmd = r"C:\Program Files\Tesseract-OCR\tesseract.exe"
    
    def cargar_placas(self):
        """Cargar placas desde archivo JSON"""
        try:
            with open(self.archivo_placas, 'r') as f:
                datos = json.load(f)
                return set(datos['placas'])  # Usar set para b√∫squeda r√°pida
        except FileNotFoundError:
            # Crear archivo con placas por defecto
            placas_default = {
                "placas": [
                    "XYZ789", "HDUS-22", "UISG-33", "OSHO-D9",
                    "IU82-94", "WHIW-34", "AAA-OOO-A", "ZAC-012-A"
                ]
            }
            with open(self.archivo_placas, 'w') as f:
                json.dump(placas_default, f, indent=4)
            return set(placas_default['placas'])
    
    def agregar_placa(self, placa):
        """Agregar nueva placa autorizada"""
        self.placas_autorizadas.add(placa.upper())
        self.guardar_placas()
        print(f"‚úÖ Placa {placa} agregada al sistema")
    
    def eliminar_placa(self, placa):
        """Eliminar placa del sistema"""
        if placa.upper() in self.placas_autorizadas:
            self.placas_autorizadas.remove(placa.upper())
            self.guardar_placas()
            print(f"üóëÔ∏è Placa {placa} eliminada del sistema")
        else:
            print(f"‚ö†Ô∏è Placa {placa} no encontrada")
    
    def guardar_placas(self):
        """Guardar placas en archivo JSON"""
        with open(self.archivo_placas, 'w') as f:
            json.dump({"placas": list(self.placas_autorizadas)}, f, indent=4)
    
    def procesar_placa(self, imagen_path):
        """Procesar imagen y extraer placa"""
        try:
            # Cargar y procesar imagen
            img = cv2.imread(imagen_path)
            if img is None:
                print("‚ùå Error: No se pudo cargar la imagen")
                return None
            
            # Preprocesamiento
            img = cv2.resize(img, (800, 300))
            gris = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
            binario = cv2.threshold(gris, 120, 255, cv2.THRESH_BINARY)[1]
            
            # OCR
            texto = pytesseract.image_to_string(binario, lang="spa")
            placa = texto.strip().replace(' ', '').upper()
            
            return placa, img
            
        except Exception as e:
            print(f"‚ùå Error al procesar imagen: {e}")
            return None, None
    
    def verificar_acceso(self, placa):
        """Verificar si la placa tiene acceso autorizado"""
        fecha_hora = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        if placa in self.placas_autorizadas:
            resultado = {
                "placa": placa,
                "autorizada": True,
                "fecha_hora": fecha_hora,
                "mensaje": "ACCESO AUTORIZADO"
            }
            print("\n" + "="*60)
            print("‚úÖ ACCESO AUTORIZADO")
            print("="*60)
            print(f"Placa: {placa}")
            print(f"Fecha/Hora: {fecha_hora}")
            print("Bienvenido al estacionamiento")
            print("="*60)
        else:
            resultado = {
                "placa": placa,
                "autorizada": False,
                "fecha_hora": fecha_hora,
                "mensaje": "ACCESO DENEGADO"
            }
            print("\n" + "="*60)
            print("üö´ ACCESO DENEGADO")
            print("="*60)
            print(f"Placa: {placa}")
            print(f"Fecha/Hora: {fecha_hora}")
            print("Placa no autorizada")
            print("="*60)
        
        # Registrar acceso
        self.registro_accesos.append(resultado)
        return resultado
    
    def mostrar_registro(self):
        """Mostrar historial de accesos"""
        print("\n" + "="*60)
        print("HISTORIAL DE ACCESOS")
        print("="*60)
        
        if not self.registro_accesos:
            print("No hay registros")
            return
        
        for i, registro in enumerate(self.registro_accesos, 1):
            estado = "‚úÖ" if registro['autorizada'] else "üö´"
            print(f"\n{i}. {estado} {registro['placa']}")
            print(f"   {registro['fecha_hora']}")
            print(f"   {registro['mensaje']}")
        
        print("="*60)
    
    def listar_placas_autorizadas(self):
        """Mostrar todas las placas autorizadas"""
        print("\n" + "="*60)
        print("PLACAS AUTORIZADAS")
        print("="*60)
        
        for i, placa in enumerate(sorted(self.placas_autorizadas), 1):
            print(f"{i}. üöó {placa}")
        
        print("="*60)
        print(f"Total: {len(self.placas_autorizadas)} placas")

# Ejemplo de uso
if __name__ == '__main__':
    sistema = SistemaEstacionamiento()
    
    # Procesar imagen de placa
    placa_detectada, imagen = sistema.procesar_placa('placa.jpg')
    
    if placa_detectada:
        # Verificar acceso
        resultado = sistema.verificar_acceso(placa_detectada)
        
        # Mostrar imagen
        if imagen is not None:
            cv2.imshow("Placa Detectada", imagen)
            cv2.waitKey(0)
            cv2.destroyAllWindows()
    
    # Gesti√≥n del sistema
    # sistema.agregar_placa("NEW-123")
    #